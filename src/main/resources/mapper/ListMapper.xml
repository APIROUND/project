<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.ApiRound.mapper.ListMapper">

    <resultMap id="ListDtoResultMap" type="com.example.ApiRound.dto.ListDto">
        <id column="id" property="id"/>
        <result column="name" property="name"/>
        <result column="region" property="region"/>
        <result column="subregion" property="subregion"/>
        <result column="address" property="address"/>
        <result column="phone" property="phone"/>
        <result column="homepage" property="homepage"/>
        <result column="coord_x" property="coordX"/>
        <result column="coord_y" property="coordY"/>
        <result column="category" property="category"/>
    </resultMap>

    <select id="findAll" resultMap="ListDtoResultMap">
        SELECT * FROM ITEM_LIST ORDER BY id ASC
    </select>

    <select id="findById" parameterType="long" resultMap="ListDtoResultMap">
        SELECT * FROM ITEM_LIST WHERE id = #{id}
    </select>

    <select id="findByCategory" parameterType="java.lang.String" resultMap="ListDtoResultMap">
        SELECT * FROM ITEM_LIST WHERE category LIKE '%' || #{category} || '%' ORDER BY id ASC
    </select>

    <select id="findByRegionAndCategory" parameterType="map" resultMap="ListDtoResultMap">
        SELECT * FROM ITEM_LIST
        WHERE region LIKE '%' || #{region} || '%'
        AND subregion LIKE '%' || #{subregion} || '%'
        AND category LIKE '%' || #{category} || '%'
        ORDER BY id ASC
    </select>

    <!-- 전체 개수 -->
    <select id="countByRegionAndCategory" parameterType="map" resultType="int">
        SELECT COUNT(*)
        FROM ITEM_LIST
        WHERE region    LIKE '%' || #{region}    || '%'
        AND subregion LIKE '%' || #{subregion} || '%'
        AND category  LIKE '%' || #{category}  || '%'
    </select>
 
    <!-- 페이징 조회 (Oracle 12c+) -->
    <select id="findByRegionAndCategoryPaged" parameterType="map" resultMap="ListDtoResultMap">
        SELECT id, name, region, subregion, address, phone, homepage, coord_x, coord_y, category
        FROM ITEM_LIST
        WHERE region    LIKE '%' || #{region}    || '%'
        AND subregion LIKE '%' || #{subregion} || '%'
        AND category  LIKE '%' || #{category}  || '%'
        ORDER BY id ASC
        OFFSET #{offset} ROWS FETCH NEXT #{limit} ROWS ONLY
    </select>

    <!-- 카테고리별 총 개수 -->
    <select id="countByCategory" parameterType="java.lang.String" resultType="int">
        SELECT COUNT(*)
        FROM ITEM_LIST
        WHERE category LIKE '%' || #{category} || '%'
    </select>

    <!-- 디버깅용: 모든 카테고리 값 조회 -->
    <select id="getAllCategories" resultType="java.lang.String">
        SELECT DISTINCT category FROM ITEM_LIST ORDER BY category
    </select>

    <!-- 카테고리별 페이징 조회 -->
    <select id="findByCategoryPaged" resultMap="ListDtoResultMap">
        SELECT id, name, region, subregion, address, phone, homepage, coord_x, coord_y, category
        FROM ITEM_LIST
        WHERE category LIKE '%' || #{category} || '%'
        ORDER BY id ASC
        OFFSET #{offset} ROWS FETCH NEXT #{amount} ROWS ONLY
    </select>

</mapper>
